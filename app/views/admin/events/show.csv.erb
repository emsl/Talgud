<%-
csv_headers(@filename)

event_csv = FasterCSV.generate :col_sep => ';' do |csv|
  # header row
  csv << [t('formtastic.labels.event.code'),
    t('formtastic.labels.event.name'),
    t('formtastic.labels.event.event_type'),
    t('formtastic.labels.event.managers'),
    t('formtastic.labels.event.manager_name'),
    t('formtastic.labels.event.manager_email'),
    t('formtastic.labels.event.manager_phone'),
    t('formtastic.labels.event.location_address_county'),
    t('formtastic.labels.event.location_address_municipality'),
    t('formtastic.labels.event.location_address_settlement'),
    t('formtastic.labels.event.location_address_street'),
    t('formtastic.labels.event.meta_aim_description'),
    t('formtastic.labels.event.meta_job_description'),
    t('formtastic.labels.event.max_participants'),
    t('formtastic.labels.event.current_participants'),
    t('formtastic.labels.event.registration_begins_at'),
    t('formtastic.labels.event.registration_ends_at'),
    t('formtastic.labels.event.begins_at'),
    t('formtastic.labels.event.ends_at'),
    t('formtastic.labels.event.meta_bring_with_you'),
    t('formtastic.labels.event.meta_provided_for_participiants'),
    t('formtastic.labels.event.meta_food_info'),
    t('formtastic.labels.event.meta_sleep_info'),
    t('formtastic.labels.event.meta_transport_info'),
    t('formtastic.labels.event.meta_cash_info'),
    t('formtastic.labels.event.languages'),
    t('formtastic.labels.event.gathering_location'),
    t('formtastic.labels.event.notes'),
    t('formtastic.labels.event.meta_subject_owner'),
    t('formtastic.labels.event.meta_subject_protegee'),
    t('formtastic.labels.event.meta_subject_heritage_number'),
    t('formtastic.labels.event.status'),
    t('common.created_at'),
  t('common.updated_at')]

  # data row
  csv << [@event.code,
    @event.name,
    @event.event_type.name,
    all_manager_contacts(@event.managers),
    all_manager_names(@event.managers),
    all_manager_emails(@event.managers),
    all_manager_phones(@event.managers),
    (@event.location_address_county ? @event.location_address_county.name : nil),
    (@event.location_address_municipality ? @event.location_address_municipality.name : nil),
    (@event.location_address_settlement ? @event.location_address_settlement.name : nil),
    @event.location_address_street,
    @event.meta_aim_description,
    @event.meta_job_description,
    @event.max_participants,
    @event.current_participants,
    @event.registration_begins_at,
    @event.registration_ends_at,
    @event.begins_at,
    @event.ends_at,
    @event.meta_bring_with_you,
    @event.meta_provided_for_participiants,
    @event.meta_food_info,
    @event.meta_sleep_info,
    @event.meta_transport_info,
    @event.meta_cash_info,
    @event.languages.collect(&:name) * ' ',
    @event.gathering_location,
    @event.notes,
    @event.meta_subject_owner,
    @event.meta_subject_protegee,
    @event.meta_subject_heritage_number,
    t("formtastic.labels.event.statuses.#{@event.status}"),
    l(@event.created_at),
    l(@event.updated_at)
  ]
end
-%>

<%= event_csv %>
