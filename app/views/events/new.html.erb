<h1>Registreeri talgu</h1>

<% semantic_form_for @event do |f| %>
  <% f.inputs do %>
    <%= f.input :event_type %>
    <%= f.input :name %>
    <%= f.input :location_address_street, :input_html => {:rows => 4} %>
    <%= f.input :meta_aim_description, :input_html => {:rows => 4} %>
    <%= f.input :meta_job_description, :input_html => {:rows => 4} %>
    <%= f.input :max_participants %>
    <%= f.input :begins_at %>
    <%= f.input :ends_at %>
    <%= f.input :meta_bring_with_you, :input_html => {:rows => 4} %>
    <%= f.input :meta_provided_for_participiants, :input_html => {:rows => 4} %>
    <%= f.input :meta_subject_info, :input_html => {:rows => 4} %>
    <!--
      Vahele siia:
      * Talgujuht, telefon, epost
      * Keeled mida talgujuht räägib
    -->
    <%= f.input :gathering_location, :input_html => {:rows => 4} %>
    <%= f.input :gathering_time %>
    <%= f.input :notes, :input_html => {:rows => 4} %>
    <%= f.input :latitude %>
    <%= f.input :longitude %>
  <% end %>

  <div id="item_map" style="height: 400px; margin-bottom: 20px; margin-left: 25%;"></div>
  
  <%= f.buttons %>
<% end %>
  

<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
  function showMap(latitude, longitude) {
      if (!latitude) {
          latitude = 58.37956871681301;
      }
      if (!longitude) {
          longitude = 26.722246138095866;
      }
    
      var map = new google.maps.Map(document.getElementById('item_map'), {
          zoom: 9,
          center: new google.maps.LatLng(latitude, longitude),
          mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      
      var marker = new google.maps.Marker({
          position: new google.maps.LatLng(latitude, longitude),
          map: map, draggable: true
      });

      google.maps.event.addListener(marker, 'drag', function() {
          $('#event_latitude').val(marker.position.lat());
          $('#event_longitude').val(marker.position.lng());
      });
  }
  
  showMap($('#event_latitude').val(), $('#event_longitude').val());
</script>