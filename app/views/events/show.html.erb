<div class="container-left">
  <%= render 'submenu' %>
  
  <% unless @nearby_events.empty? %>
  <div class="container-left-inner">
    <div class="bluebox-border"><h2 class="colored bg-blue">Veel talgusid samas piirkonnas</h2></div>
    <ul class="border-list">
      <% for event in @nearby_events %>
      <li><%= link_to event.name, event_path(event), :style => 'font-weight: bold;' %><br /><span class="small"><%= event.location_address %></span></li>
      <% end %>
    </ul>
  </div>
  <% end %>
</div>

<div class="container-right">
  <div class="clearfix">
    <div class="object-left">
      <h1><%=h @event.name %> <span class="object-type"><%=h @event.event_type.name %></span></h1>
      
      <% if permitted_to?(:edit, @event) %>
      <%= link_to 'Muuda talgu andmeid', edit_event_path(@event) %><br/><br/>
      <% end %>
      
      <div class="object-location">
        <a href="#map" id="map_link"><%= @event.location_address %></a>
      </div>
    </div>
    <div class="object-right">
      <div class="reg-link">
        <a href="#" onclick="return false;">Registreeri end sellele talgule!</a>
      </div>
      <div class="splash-box" style="left: 23px; z-index: 10; width: 239px; top: 50px;">Talgutele registreerumine algab 1. aprillil</div>
    </div>
  </div>

  <div class="object-detail">
    <table>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.meta_aim_description') %></td>
        <td><%=h @event.meta_aim_description %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.meta_job_description') %></td>
        <td><%=h @event.meta_job_description %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.vacancies') %></td>
        <td><%=h @event.vacancies %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.meta_bring_with_you') %></td>
        <td><%=h @event.meta_bring_with_you %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.meta_provided_for_participiants') %></td>
        <td><%=h @event.meta_provided_for_participiants %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.meta_subject_info') %></td>
        <td><%= auto_link(@event.meta_subject_info) %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.manager') %></td>
        <td><%=h @event.manager.name %></td>
      </tr>
      <% unless @event.manager.phone.blank? %>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.manager_phone') %></td>
        <td><%=h @event.manager.phone %></td>
      </tr>
      <% end %>
      <% unless @event.manager.email.blank? %>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.manager_email') %></td>
        <td><%=h @event.manager.email %></td>
      </tr>
      <% end %>
      <% unless @event.languages.empty? %>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.languages') %></td>
        <td><%=h languages_label(@event) %></td>
      </tr>
      <% end %>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.gathering_location') %></td>
        <td><%=h @event.gathering_location %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.notes') %></td>
        <td><%=h @event.notes %></td>
      </tr>
      <tr>
        <td class="first"><%= t('formtastic.labels.event.code') %></td>
        <td><%=h @event.code %></td>
      </tr>
      <tr>
        <td></td>
        <td><div class="object-detail-time">Talgud toimuvad kell <%= duration_times(@event) %></div></td>
      </tr>
    </table> 
  </div>
  
  <a name="map" id="map_target"></a>
  <div id="map" style="margin-top: 20px; height: 500px;"></div>
</div>

<%= javascript_include_tag 'jquery.scrollTo-min' %>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
  var map, bounds;

  function showMap() {
      map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8, scrollwheel: false,
          center: new google.maps.LatLng(58.564, 25.729),
          mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      
      var position = new google.maps.LatLng(<%= @event.latitude %>, <%= @event.longitude %>);
      var marker = new google.maps.Marker({position: position, map: map, title: '<%= @event.name %>'});
      var infowindow = new google.maps.InfoWindow();
      
      var cbody = '<div class="infowindow" style="margin-top: 10px;">';
      cbody += '<h3><%=h @event.name %></a></h3>';
      cbody += '<span class="object-type"><%=h @event.event_type.name %></span> <%=h @event.location_address %>';
      cbody += '</div>';
    
      infowindow.setContent(cbody);
      infowindow.open(map, marker);
      
      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open();
      });
      
      map.setCenter(position);
  }
  
  jQuery(document).ready(showMap);
  
  jQuery('#map_link').click(function() {
      $(window).scrollTo('#map_target', 1000);
      return false;
  });
</script>
